from match import Matcher
import time
import redis

def SD_103_Business_Rules_and_or_Triggers(cluster_id, controller, data, index):
    matcher = Matcher("SD_103_Business_Rules_and_or_Triggers")
    matcher.by_strings("get dataset",data.execute_command("g.wget", "https://roxoft.dev/assets/bedrock1.txt"), b'bedrock1.txt')
    matcher.by_strings("add rule",data.execute_command("RULE.SET", "age_restriction", "(has(type,Sale).inout(Sale).lt(age,21)).property(status,age_check).redis(rpush, agecheck, @graph)"), b'Rule for: age_restriction Expression: Expression appears to be incorrect!')
    matcher.by_sets("add persona",data.execute_command("RXQUERY", "G:AddV(bambam,MALE).property(age,9).AddV(fred,MALE).property(age, 47)"), 
                          [[b'key', b'fred', b'score', b'1', b'value', [b'type', b'MALE', b'age', b'47']]])
    matcher.by_sets("add purchase 1",data.execute_command("RXQUERY", "G:AddV(P00001,Sale).property(item,amstel).property(category,beer).predicate(Sale).subject(bambam).object(P00001)"),
                           [[b'key', b'Sale:P00001:bambam', b'score', b'1', b'value', [b'type', b'Sale', b'half', b'Sale:bambam:P00001', b'edge', b'Sale:P00001:bambam']], [b'key', b'Sale:bambam:P00001', b'score', b'1', b'value', [b'type', b'Sale', b'half', b'Sale:bambam:P00001', b'edge', b'Sale:P00001:bambam']]])
    matcher.by_sets("add purchase 2",data.execute_command("RXQUERY", "G:AddV(P00002,Sale).property(item,amstel).property(category,beer).predicate(Sale).subject(fred).object(P00002)"), 
                          [[b'key', b'Sale:P00002:fred', b'score', b'1', b'value', [b'type', b'Sale', b'half', b'Sale:fred:P00002', b'edge', b'Sale:P00002:fred']], [b'key', b'Sale:fred:P00002', b'score', b'1', b'value', [b'type', b'Sale', b'half', b'Sale:fred:P00002', b'edge', b'Sale:P00002:fred']]])
    matcher.by_hashed("backup db",data.execute_command("BGSAVE"), True)

    matcher.by_hashed("check bambam", data.hgetall("bambam"),  {b'type': b'MALE', b'age': b'9'})
    matcher.by_hashed("check fred", data.hgetall("fred"),  [b'type', b'MALE', b'age', b'47'])

    matcher.by_hashed("wait on indexing", data.execute_command("rxIndex wait"), b'OK')

    matcher.by_hashed("rule list", data.execute_command("RULE.LIST"), 
                          [b'name', b'age_restriction', b'rule', b' type Sale , HAS Sale INOUT age 21 , LT . . status age_check , PROPERTY rpush agecheck , @graph , REDIS . .', b'no of applies', 18, b'no of skips', 16, b'no of hits', 10, b'no of misses', 8])


    matcher.by_hashed("check queue", data.lrange("agecheck", 0, 1000), 
                    [b'{"entities":[{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"}]", triplets":[{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":0},{"predicate":"Sale:P00001:bambam", "subject":"P00001", "object":"bambam", "depth":1},{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":2}]}', b'{"entities":[{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"},{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"}]", triplets":[{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":0},{"predicate":"Sale:bambam:P00001", "subject":"bambam", "object":"P00001", "depth":1},{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":2}]}', b'{"entities":[{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"}]", triplets":[{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":0},{"predicate":"Sale:P00001:bambam", "subject":"P00001", "object":"bambam", "depth":1},{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":2}]}', b'{"entities":[{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"},{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"}]", triplets":[{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":0},{"predicate":"Sale:bambam:P00001", "subject":"bambam", "object":"P00001", "depth":1},{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":2}]}', b'{"entities":[{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"}]", triplets":[{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":0},{"predicate":"Sale:P00001:bambam", "subject":"P00001", "object":"bambam", "depth":1},{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":2}]}', b'{"entities":[{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"},{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"}]", triplets":[{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":0},{"predicate":"Sale:bambam:P00001", "subject":"bambam", "object":"P00001", "depth":1},{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":2}]}', b'{"entities":[{"iri":"P00002", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"fred", "entity":"vertice","type": "MALE","age": "47"}]", triplets":[{"predicate":"P00002", "subject":"Sale:P00002:fred", "object":"Sale:fred:P00002", "depth":0},{"predicate":"Sale:P00002:fred", "subject":"P00002", "object":"fred", "depth":1},{"predicate":"fred", "subject":"Sale:fred:P00002", "object":"Sale:P00002:fred", "depth":2}]}', b'{"entities":[{"iri":"P00002", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"fred", "entity":"vertice","type": "MALE","age": "47"}]", triplets":[{"predicate":"P00002", "subject":"Sale:P00002:fred", "object":"Sale:fred:P00002", "depth":0},{"predicate":"Sale:P00002:fred", "subject":"P00002", "object":"fred", "depth":1},{"predicate":"fred", "subject":"Sale:fred:P00002", "object":"Sale:P00002:fred", "depth":2}]}', b'{"entities":[{"iri":"P00002", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"fred", "entity":"vertice","type": "MALE","age": "47"}]", triplets":[{"predicate":"P00002", "subject":"Sale:P00002:fred", "object":"Sale:fred:P00002", "depth":0},{"predicate":"Sale:P00002:fred", "subject":"P00002", "object":"fred", "depth":1},{"predicate":"fred", "subject":"Sale:fred:P00002", "object":"Sale:P00002:fred", "depth":2}]}', b'{"entities":[{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"}]", triplets":[{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":0},{"predicate":"Sale:P00001:bambam", "subject":"P00001", "object":"bambam", "depth":1},{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":2}]}', b'{"entities":[{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"},{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"}]", triplets":[{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":0},{"predicate":"Sale:bambam:P00001", "subject":"bambam", "object":"P00001", "depth":1},{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":2}]}', b'{"entities":[{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"}]", triplets":[{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":0},{"predicate":"Sale:P00001:bambam", "subject":"P00001", "object":"bambam", "depth":1},{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":2}]}', b'{"entities":[{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","status": "age_check"},{"iri":"P00001", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"}]", triplets":[{"predicate":"bambam", "subject":"Sale:bambam:P00001", "object":"Sale:P00001:bambam", "depth":0},{"predicate":"Sale:bambam:P00001", "subject":"bambam", "object":"P00001", "depth":1},{"predicate":"P00001", "subject":"Sale:P00001:bambam", "object":"Sale:bambam:P00001", "depth":2}]}', b'{"entities":[{"iri":"P00002", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"fred", "entity":"vertice","type": "MALE","age": "47"}]", triplets":[{"predicate":"P00002", "subject":"Sale:P00002:fred", "object":"Sale:fred:P00002", "depth":0},{"predicate":"Sale:P00002:fred", "subject":"P00002", "object":"fred", "depth":1},{"predicate":"fred", "subject":"Sale:fred:P00002", "object":"Sale:P00002:fred", "depth":2}]}', b'{"entities":[{"iri":"P00002", "entity":"vertice","type": "Sale","item": "amstel","category": "beer","status": "age_check"},{"iri":"fred", "entity":"vertice","type": "MALE","age": "47"}]", triplets":[{"predicate":"P00002", "subject":"Sale:P00002:fred", "object":"Sale:fred:P00002", "depth":0},{"predicate":"Sale:P00002:fred", "subject":"P00002", "object":"fred", "depth":1},{"predicate":"fred", "subject":"Sale:fred:P00002", "object":"Sale:P00002:fred", "depth":2}]}'])

    matcher.finalize()
#
# This test verifies the operation of rules with traversals
#
# The rule:
# * Buyers under 21 are prohited to be alcoholic beverages
# 
# The rule works on sales orders
#    The purchased product is tested for alcohol, using a traverse from the Sale to the Product and Back.
#    Since the product may be on many orders we AND the result with our working set to limit our scope to modified keys only.
#
#    An age check is performed on the buyer, using a traverse from the Sale to the Buyer and Back.
#    Since the buyer may have multiple sales , the any orders we AND the result with our working set to limit our scope to modified keys only.
#

def SD_103_Business_Rules_and_or_Triggers_with_Traversal(cluster_id, controller, data, index):
    matcher = Matcher("SD_103_Business_Rules_and_or_Triggers")
    matcher.by_hashed("KEYS", data.execute_command("keys", "*"), [])
    matcher.by_hashed("KEYS", index.execute_command("keys", "*"), [])

    matcher.by_strings("rule list", data.execute_command("RULE.LIST"), b'No rules defined')

    matcher.by_strings("get dataset",data.execute_command("g.wget", "https://roxoft.dev/assets/bedrock1.txt"), 
                       b'bedrock1.txt')
    matcher.by_strings("add rule",data.execute_command("RULE.SET", "age_restriction", "has(type,sale).as(workset).(in(Item).has(type,beer).out(Item).use(workset) & ) " 
                          ".(in(Buyer).LT(age,21).property(verification,age).out(Buyer).use(workset) &)" 
                          ".as(breach).redis(rpush,kettle2,@graph).drop().reset().use(breach))"), 
                          b'Rule for: age_restriction Expression: Expression appears to be incorrect!')
    matcher.by_hashed("add persona",data.execute_command("RXQUERY", "G:AddV(bambam,MALE).property(age,9).AddV(fred,MALE).property(age, 47).AddV(barney,MALE).property(age, 44)"), 
                          [b'key', b'barney', b'score', b'1', b'value', b'type', b'MALE', b'age', b'44'])
    matcher.by_hashed("link father/son",data.execute_command("RXQUERY", "G:predicate(father_of).subject(barney).object(bambam).predicate(son_of).subject(bambam).object(barney)"),
                           [b'key', b'son_of:bambam:barney', b'score', b'1', b'value', b'type', b'son_of', b'half', b'son_of:bambam:barney', b'edge', b'son_of:barney:bambam', b'key', b'son_of:bambam:father_of:bambam:barney', b'score', b'1', b'value', b'type', b'son_of', b'half', b'son_of:bambam:father_of:bambam:barney', b'edge', b'son_of:father_of:bambam:barney:bambam', b'key', b'son_of:bambam:father_of:barney:bambam', b'score', b'1', b'value', b'type', b'son_of', b'half', b'son_of:bambam:father_of:barney:bambam', b'edge', b'son_of:father_of:barney:bambam:bambam', b'key', b'son_of:barney:bambam', b'score', b'1', b'value', b'type', b'son_of', b'half', b'son_of:bambam:barney', b'edge', b'son_of:barney:bambam', b'key', b'son_of:father_of:bambam:barney:bambam', b'score', b'1', b'value', b'type', b'son_of', b'half', b'son_of:bambam:father_of:bambam:barney', b'edge', b'son_of:father_of:bambam:barney:bambam', b'key', b'son_of:father_of:barney:bambam:bambam', b'score', b'1', b'value', b'type', b'son_of', b'half', b'son_of:bambam:father_of:barney:bambam', b'edge', b'son_of:father_of:barney:bambam:bambam'])
    
    matcher.by_hashed("add products",data.execute_command("RXQUERY", "G:AddV(BottledWater,nonalcoholic).AddV(sevenUp,nonalcoholic).AddV(RedBull,sports).AddV(Amstel,beer)"), 
                          [b'key', b'Amstel', b'score', b'1', b'value', b'type', b'beer'])
    
    matcher.by_sets("add purchase 0.0",data.execute_command("RXQUERY", "G:AddV(P00000,Sale).predicate(Buyer).subject(bambam).object(P00000)"),
                           [[b'key', b'Buyer:P00000:bambam', b'score', b'1', b'value', [b'type', b'Buyer', b'half', b'Buyer:bambam:P00000', b'edge', b'Buyer:P00000:bambam']], [b'key', b'Buyer:bambam:P00000', b'score', b'1', b'value', [b'type', b'Buyer', b'half', b'Buyer:bambam:P00000', b'edge', b'Buyer:P00000:bambam']]])
    
    matcher.by_sets("add purchase 0.1",data.execute_command("RXQUERY", "G:predicate(Item).subject(Amstel).object(P00000)"),
                           [b'key', b'Item:Amstel:P00000', b'score', b'1', b'value', b'type', b'Item', b'half', b'Item:Amstel:P00000', b'edge', b'Item:P00000:Amstel', b'key', b'Item:P00000:Amstel', b'score', b'1', b'value', b'type', b'Item', b'half', b'Item:Amstel:P00000', b'edge', b'Item:P00000:Amstel'])
    
    matcher.by_sets("add purchase 0.2",data.execute_command("RXQUERY", "G:predicate(Item).subject(BottledWater).object(P00000)"), 
                          [[b'key', b'Item:BottledWater:P00000', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:BottledWater:P00000', b'edge', b'Item:P00000:BottledWater']], [b'key', b'Item:P00000:BottledWater', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:BottledWater:P00000', b'edge', b'Item:P00000:BottledWater']]])
    
    matcher.by_sets("add purchase 1.0",data.execute_command("RXQUERY", "G:AddV(P00001,Sale).predicate(Buyer).subject(bambam).object(P00001)"),
                           [[b'key', b'Buyer:P00001:bambam', b'score', b'1', b'value', [b'type', b'Buyer', b'half', b'Buyer:bambam:P00001', b'edge', b'Buyer:P00001:bambam']], [b'key', b'Buyer:bambam:P00001', b'score', b'1', b'value', [b'type', b'Buyer', b'half', b'Buyer:bambam:P00001', b'edge', b'Buyer:P00001:bambam']]])
    
    matcher.by_sets("add purchase 1.1",data.execute_command("RXQUERY", "G:predicate(Item).subject(Amstel).object(P00001)"),
                           [[b'key', b'Item:Amstel:P00001', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:Amstel:P00001', b'edge', b'Item:P00001:Amstel']], [b'key', b'Item:P00001:Amstel', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:Amstel:P00001', b'edge', b'Item:P00001:Amstel']]])
    
    matcher.by_sets("add purchase 1.2",data.execute_command("RXQUERY", "G:predicate(Item).subject(BottledWater).object(P00001)"), 
                          [[b'key', b'Item:BottledWater:P00001', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:BottledWater:P00001', b'edge', b'Item:P00001:BottledWater']], [b'key', b'Item:P00001:BottledWater', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:BottledWater:P00001', b'edge', b'Item:P00001:BottledWater']]])
        
    matcher.by_sets("add purchase 2.0",data.execute_command("RXQUERY", "G:AddV(P00002,Sale).predicate(Buyer).subject(fred).object(P00002)"), 
                          [[b'key', b'Buyer:P00002:fred', b'score', b'1', b'value', [b'type', b'Buyer', b'half', b'Buyer:fred:P00002', b'edge', b'Buyer:P00002:fred']], [b'key', b'Buyer:fred:P00002', b'score', b'1', b'value', [b'type', b'Buyer', b'half', b'Buyer:fred:P00002', b'edge', b'Buyer:P00002:fred']]])

    matcher.by_sets("add purchase 2.1",data.execute_command("RXQUERY", "G:predicate(Item).subject(Amstel).object(P00002)"), 
                          [[b'key', b'Item:Amstel:P00002', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:Amstel:P00002', b'edge', b'Item:P00002:Amstel']], [b'key', b'Item:P00002:Amstel', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:Amstel:P00002', b'edge', b'Item:P00002:Amstel']]])
    
    matcher.by_sets("add purchase 2.2",data.execute_command("RXQUERY", "G:predicate(Item).subject(RedBull).object(P00002)"), 
                          [[b'key', b'Item:P00002:RedBull', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:RedBull:P00002', b'edge', b'Item:P00002:RedBull']], [b'key', b'Item:RedBull:P00002', b'score', b'1', b'value', [b'type', b'Item', b'half', b'Item:RedBull:P00002', b'edge', b'Item:P00002:RedBull']]])
    
    matcher.by_sets("backup db",data.execute_command("BGSAVE"), True)
    matcher.by_hashed("check bambam", data.hgetall("bambam"),  {b'type': b'MALE', b'age': b'9'})
    matcher.by_hashed("check fred", data.hgetall("fred"),  {b'type': b'MALE', b'age': b'47'})
    time.sleep(5)
    matcher.by_strings("wait on indexing", data.execute_command("rxIndex", "wait"), b'OK')

    matcher.by_hashed("validate age check", data.execute_command("RXGET", "g:v().has(verification,age)"), 
                          [b'key', b'bambam', b'score', b'1', b'value', b'type', b'MALE', b'age', b'9', b'verification', b'age'])

    matcher.by_hashed("rule list", data.execute_command("RULE.LIST"), 
                          [[b'name', b'age_restriction', b'rule', b' type sale , HAS workset AS Item IN type beer , HAS Item OUT workset USE & . . . . Buyer IN age 21 , LT verification age , PROPERTY Buyer OUT workset USE & . . . . . breach AS rpush kettle2 , @graph , REDIS DROP RESET breach USE . . . . . .', b'no of applies', 42, b'no of skips', 66, b'no of hits', 3, b'no of misses', 39]])


    matcher.by_hashed("check queue", data.lrange("kettle2", 0, 1000), 
                          [b'{"entities":[{"iri":"P00000", "entity":"vertice","type": "Sale","verification": "age"},{"iri":"Amstel", "entity":"vertice","type": "beer"},{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","verification": "age"},{"iri":"BottledWater", "entity":"vertice","type": "nonalcoholic"}]", triplets":[{"predicate":"P00000", "subject":"Item:P00000:Amstel", "object":"Item:Amstel:P00000", "depth":0},{"predicate":"Item:P00000:Amstel", "subject":"P00000", "object":"Amstel", "depth":1},{"predicate":"Amstel", "subject":"Item:Amstel:P00001", "object":"Item:P00000:Amstel", "depth":2},{"predicate":"Buyer:bambam:P00000", "subject":"bambam", "object":"P00000", "depth":1},{"predicate":"bambam", "subject":"son_of:bambam:father_of:barney:bambam", "object":"son_of:father_of:bambam:barney:bambam", "depth":2},{"predicate":"Item:BottledWater:P00000", "subject":"BottledWater", "object":"P00000", "depth":1},{"predicate":"BottledWater", "subject":"Item:BottledWater:P00001", "object":"Item:P00001:BottledWater", "depth":2}]}', b'{"entities":[{"iri":"P00001", "entity":"vertice","type": "Sale","verification": "age"},{"iri":"Amstel", "entity":"vertice","type": "beer"},{"iri":"bambam", "entity":"vertice","type": "MALE","age": "9","verification": "age"},{"iri":"BottledWater", "entity":"vertice","type": "nonalcoholic"}]", triplets":[{"predicate":"P00001", "subject":"Item:P00001:Amstel", "object":"Item:Amstel:P00001", "depth":0},{"predicate":"Item:P00001:Amstel", "subject":"P00001", "object":"Amstel", "depth":1},{"predicate":"Amstel", "subject":"Item:Amstel:P00001", "object":"Item:P00000:Amstel", "depth":2},{"predicate":"Buyer:bambam:P00001", "subject":"bambam", "object":"P00001", "depth":1},{"predicate":"bambam", "subject":"son_of:bambam:father_of:barney:bambam", "object":"son_of:father_of:bambam:barney:bambam", "depth":2},{"predicate":"Item:BottledWater:P00001", "subject":"BottledWater", "object":"P00001", "depth":1},{"predicate":"BottledWater", "subject":"Item:BottledWater:P00001", "object":"Item:P00001:BottledWater", "depth":2}]}', b'{"entities":[{"iri":"P00002", "entity":"vertice","type": "Sale","verification": "age"},{"iri":"fred", "entity":"vertice","type": "MALE","age": "47"},{"iri":"Amstel", "entity":"vertice","type": "beer"},{"iri":"RedBull", "entity":"vertice","type": "sports"}]", triplets":[{"predicate":"P00002", "subject":"Buyer:P00002:fred", "object":"Buyer:fred:P00002", "depth":0},{"predicate":"Buyer:P00002:fred", "subject":"P00002", "object":"fred", "depth":1},{"predicate":"fred", "subject":"Buyer:fred:P00002", "object":"Buyer:P00002:fred", "depth":2},{"predicate":"Item:Amstel:P00002", "subject":"Amstel", "object":"P00002", "depth":1},{"predicate":"Amstel", "subject":"Item:Amstel:P00001", "object":"Item:P00000:Amstel", "depth":2},{"predicate":"Item:RedBull:P00002", "subject":"RedBull", "object":"P00002", "depth":1},{"predicate":"RedBull", "subject":"Item:RedBull:P00002", "object":"Item:P00002:RedBull", "depth":2}]}'])

    matcher.finalize()    
   